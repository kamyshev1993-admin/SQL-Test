--liquibase formatted sql
--changeset author:kamyshev_1.0.0

CREATE TABLE CLIENT (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
FIRST_NAME VARCHAR2(25) NOT NULL,
MIDDLE_NAME VARCHAR2(25),
LAST_NAME VARCHAR2(25) NOT NULL,
BIRTH_DAY DATE NOT NULL
);

CREATE TABLE ACCOUNT (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
CLIENT_ID NUMBER NOT NULL,
ACCOUNT_NUMBER NUMBER NOT NULL,
OPEN_DATE TIMESTAMP NOT NULL,
CLOSE_DATE TIMESTAMP NOT NULL,
FOREIGN KEY(CLIENT_ID) REFERENCES CLIENT(ID)
);

CREATE TABLE TEMPLATE (
SENDER NUMBER NOT NULL,
RECIPIENT NUMBER NOT NULL,
MONTH_COUNT NUMBER,
AMOUNT DECIMAL NOT NULL,
CREATE_DATE TIMESTAMP NOT NULL,
FOREIGN KEY(SENDER) REFERENCES ACCOUNT(ID),
FOREIGN KEY(RECIPIENT) REFERENCES ACCOUNT(ID)
);

CREATE TABLE REQUEST (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
CREATE_DATE TIMESTAMP NOT NULL,
SENDER NUMBER NOT NULL,
RECIPIENT NUMBER NOT NULL,
CLIENT_ID NUMBER NOT NULL,
FOREIGN KEY(CLIENT_ID) REFERENCES CLIENT(ID),
FOREIGN KEY(SENDER) REFERENCES ACCOUNT(ID),
FOREIGN KEY(RECIPIENT) REFERENCES ACCOUNT(ID)
);

ALTER TABLE TEMPLATE ADD ID UNIQUE REFERENCES REQUEST(ID);

CREATE TABLE STATUS (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
VALUE VARCHAR2(20) NOT NULL
);

CREATE TABLE PAYMENT (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
SENDER NUMBER NOT NULL,
RECIPIENT NUMBER NOT NULL,
AMOUNT DECIMAL NOT NULL,
STATUS_ID NUMBER NOT NULL,
TEMPLATE_ID NUMBER NOT NULL,
REQUEST_ID NUMBER NOT NULL,
CREATE_DATE TIMESTAMP NOT NULL,
FOREIGN KEY(SENDER) REFERENCES ACCOUNT(ID),
FOREIGN KEY(RECIPIENT) REFERENCES ACCOUNT(ID),
FOREIGN KEY(STATUS_ID) REFERENCES STATUS(ID),
FOREIGN KEY(TEMPLATE_ID) REFERENCES TEMPLATE(ID),
FOREIGN KEY(REQUEST_ID) REFERENCES REQUEST(ID)
);

CREATE TABLE CURRENCY (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
VALUE VARCHAR2(5) NOT NULL
);

CREATE TABLE BALANCE (
ID UNIQUE REFERENCES ACCOUNT(ID),
AMOUNT DECIMAL NOT NULL,
CURRENCY_ID NUMBER NOT NULL,
FOREIGN KEY(CURRENCY_ID) REFERENCES CURRENCY(ID)
);

CREATE TABLE AUDIT_INFO (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
STATUS_ID NUMBER NOT NULL,
PAYMENT_ID NUMBER NOT NULL,
FOREIGN KEY(STATUS_ID) REFERENCES STATUS(ID),
FOREIGN KEY(PAYMENT_ID) REFERENCES PAYMENT(ID)
);

CREATE TABLE TRANSACTION_INFO (
ID UNIQUE REFERENCES PAYMENT(ID),
SENDER NUMBER NOT NULL,
RECIPIENT NUMBER NOT NULL,
AMOUNT DECIMAL NOT NULL,
WITH_ERROR NUMBER(1) NOT NULL,
ACTION_DATE TIMESTAMP NOT NULL,
FOREIGN KEY(SENDER) REFERENCES ACCOUNT(ID),
FOREIGN KEY(RECIPIENT) REFERENCES ACCOUNT(ID)
);

INSERT INTO CLIENT (FIRST_NAME, MIDDLE_NAME, LAST_NAME, BIRTH_DAY)
VALUES('test1','test1','test1', TO_DATE('2021-05-16 03:31:43', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO CLIENT (FIRST_NAME,MIDDLE_NAME,LAST_NAME, BIRTH_DAY)
VALUES('test2','test2','test2', TO_DATE('2021-05-16 03:31:43', 'YYYY-MM-DD HH24:MI:SS'));
INSERT INTO client (FIRST_NAME,MIDDLE_NAME,LAST_NAME, BIRTH_DAY)
VALUES('test3','test3','test3', TO_DATE('2021-05-16 03:31:43', 'YYYY-MM-DD HH24:MI:SS'));
COMMIT;